define("modules/clean/account/account_photo_settings",["jquery","external/react","modules/clean/avatar/size","modules/clean/account_photo_modal/controller","modules/clean/ajax","modules/clean/avatar/components","modules/clean/viewer","modules/clean/react/modal","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,s,i,u,a,c){var l,d,h,p,_,f,m,y;return _=n.VALID_AVATAR_DIMENSIONS,d=s.Faceholder,f=s.ViewerAvatar,p=u.SimpleModal,y=a._,m=t.DOM,h={PHOTO:"photo",NO_PHOTO:"no_photo"},l=t.createClass({propTypes:{"photo-url":t.PropTypes.string,dimension:t.PropTypes.oneOf(_).isRequired},getInitialState:function(){var e;return e=this.props["photo-url"]?h.PHOTO:h.NO_PHOTO,{mode:e}},componentDidMount:function(){return e(document).on("db:account_photo:photo_set",function(e){return function(){return e.setState({mode:h.PHOTO})}}(this)),e(document).on("db:account_photo:photo_deleted",function(e){return function(){return e.setState({mode:h.NO_PHOTO})}}(this))},render:function(){return m.div({className:"account-photo-settings third-column"},m.h3({},y("Account photo")),new f({dimension:this.props.dimension,onPhotoClick:o.show,photoUrl:this.props["photo-url"],defaultAvatar:new d({dimension:this.props.dimension,onClick:o.show})}),this.renderOptions())},renderOptions:function(){var e,t;return e="account-photo-link",t=y(this.state.mode===h.PHOTO?"Change photo":"Add photo"),m.div({},m.a({className:e,onClick:this.openModalButtonClickHandler},t),this.state.mode===h.PHOTO?m.a({className:e,onClick:this.deleteButtonClickHandler},y("Delete photo")):void 0)},openModalButtonClickHandler:function(e){return e.preventDefault(),o.show()},deleteButtonClickHandler:function(t){return t.preventDefault(),p.show({title_text:y("Remove account photo"),body_html:y("Are you sure you want to remove your account photo?"),cancel_text:y("Cancel"),confirm_text:y("Remove"),confirm_callback:function(){return function(){return r.WebRequest({url:"/account/delete_account_photo",type:"POST",success:function(){return c.success(y("Account photo deleted"),3),e(document).trigger("db:account_photo:photo_deleted")},error:function(){return c.error(y("There was a problem deleting your account photo"),3)}})}}(this)})}}),{AccountPhotoSettings:l}}),define("modules/clean/account/security_keys",["external/react","external/underscore","jquery","modules/clean/ajax","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,s,i,u,a,c){var l,d,h,p,_,f,m,y;return l=r.Modal,p=r.SimpleModal,y=a._,f=a.ungettext,_=e.DOM,m=u.get_viewer(),d=e.createClass({propTypes:{initialKeys:e.PropTypes.arrayOf(e.PropTypes.object),userId:e.PropTypes.number},getInitialState:function(){return{keys:this.props.initialKeys}},addKey:function(){return l.close(),n(document).trigger("twofactor:ADD_SECURITY_KEY",this.user.id)},disableKey:function(e){return p.show({title_text:y("Disable security key?"),body_html:y("Are you sure you want to disable this security key?"),confirm_text:y("Disable"),cancel_text:y("Cancel"),confirm_callback:function(n){return function(){return new o.WebRequest({url:"/account/twofactor/u2f_disable_device",subject_user:n.props.userId,data:{u2f_gid:e.gid},success:function(){return n.setState({keys:t.without(n.state.keys,e)}),c.success(y("Successfully disabled security key."))},error:function(){return c.error(y("There was a problem disabling your security key."))}})}}(this)})},manageKeys:function(){return l.showInstance(e.createElement(h,{addKeyHandler:this.addKey,disableKeyHandler:this.disableKey,keys:this.state.keys,userId:this.props.userId}))},keysLabel:function(){return f("%(num)s key","%(num)s keys",this.state.keys.length).format({num:this.state.keys.length})},fetchKeyInfo:function(){return new o.WebRequest({url:"/account/twofactor/security_keys/",success:function(e){return function(t){return e.setState({keys:JSON.parse(t)})}}(this),subject_user:this.props.userId})},componentWillMount:function(){return this.user=m.get_user_by_id(this.props.userId)},componentDidMount:function(){return n(document).on("security-key-manager:UPDATE_KEYS",function(e){return function(t,n){return e.user.id===n?e.fetchKeyInfo():void 0}}(this)),this.fetchKeyInfo()},render:function(){var e;return e=this.state.keys.length>0,_.div({className:"manage-twofactor-security-keys"},_.span({hidden:!0,className:"update",onClick:this.fetchKeyInfo}),_.span({hidden:!e},""+this.keysLabel()+" ",_.a({className:"edit-link",onClick:this.manageKeys},y("Edit"))),_.a({onClick:this.addKey,hidden:e},y("Add")))}}),h=e.createClass({propTypes:{addKeyHandler:e.PropTypes.func,disableKeyHandler:e.PropTypes.func,keys:e.PropTypes.arrayOf(e.PropTypes.object),userId:e.PropTypes.number},componentWillMount:function(){return this.user=m.get_user_by_id(this.props.userId)},disableKey:function(e){return this.props.disableKeyHandler(e)},renderTooltipContents:function(e){return _.span({},_.p({style:{fontWeight:"bold"}},y("Signed In")),_.p({},e.ts_tz,_.br({}),e.country,_.br({}),e.device))},renderKeyRows:function(){return this.props.keys.map(function(e){return function(t){return _.li({className:"key_row"},_.span({className:"last_used_info"},y("Last used")+(" "+t.last_used.ts_ago),_.span," • "+t.last_used.country+" ",i.Tooltip({position:i.TooltipPosition.RIGHT,tooltip_contents:e.renderTooltipContents(t.last_used)},s({group:"web",name:"info"}))),_.span({className:"added_info",title:t.created.ts_tz},y("Added")+(" "+t.created.ts_ago)),_.span({className:"disable_key",onClick:function(){return e.props.disableKeyHandler(t)}},s({group:"web",name:"xclose"})))}}(this))},render:function(){var e,t;return t=m.get_title_by_role(this.user.role),e=t?" • "+t:"",l({title:y("Security Keys")+e,buttonComponent:_.div({className:"db-modal-buttons"},_.button({className:"dbmodal-button button-tertiary",onClick:this.props.addKeyHandler,style:{"float":"left",marginLeft:0}},y("Add new key")),_.button({className:"dbmodal-button button-primary",onClick:function(){return l.close()}},y("Done"))),width:680},_.div({className:"twofactor-security-keys-edit-modal"},_.p({},y("Security keys help you complete two-step verification when logging into Dropbox.")),_.div({className:"twofactor-security-keys-container"},_.ul({id:"key-rows"},this.renderKeyRows()))))}}),{SecurityKeyManager:d}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/phone_number",["jquery","external/phone_helpers","external/underscore","modules/core/dom","modules/core/i18n","modules/clean/components/select_input"],function(e,t,n,o,r){var s,i;return i=r._,s=function(){function t(e){this.$phone_input=e,this._setup_valhooks=__bind(this._setup_valhooks,this),this.set=__bind(this.set,this),this.$error_span=null,this.id=this.$phone_input.attr("id"),this.$country_select=this.$phone_input.find(".phone-country"),this.$phone_text=this.$phone_input.find(".phone-text"),this._setup_valhooks(),this._listen()}return t.prototype._listen=function(){return this._reformat(),this.$phone_text.on("blur",function(e){return function(){return e._reformat(),e.validate_on_blur()}}(this)),this.$country_select.on("change",function(e){return function(){return e._reformat(),e.validate_on_blur()}}(this)),this.$phone_text.on("focus",function(e){return function(){return e.hide_error()}}(this))},t.prototype._reformat=function(){var t,n,o;return this.hide_error(),(o=this.$phone_text.val())?(n=phone_helpers.format(this.get_country_code(),o),n?this.$phone_text.val(n):void 0):(t=phone_helpers.get_example_mobile_number(this.get_country_code()),void e("label",this.$phone_text).text(i("Example: ")+t))},t.prototype.get_country_code=function(){return phone_helpers.iso_to_dialing(this.$country_select.val()||"US")},t.prototype.get_local_number=function(){var e,t;return e=this.$phone_input.val(),t=phone_helpers.split_number(e),t.phone_number},t.prototype.is_empty=function(){return!this.$phone_text.val()},t.prototype.show_error=function(e){var t;return t=this.$phone_input.find(".phone-number-error"),t.css("display","block"),t.text(e)},t.prototype.hide_error=function(){var e;return e=this.$phone_input.find(".phone-number-error"),e.html("&nbsp;")},t.prototype.is_valid_french_polynesian_number=function(e){return"+689"!==e.slice(0,4)?!1:(e=e.slice(4),e=e.replace(/[^\d]/g,""),6===e.length||8===e.length)},t.prototype.validate_on_blur=function(){var e;return this.is_empty()?(this.hide_error(),!0):(e=this.$phone_input.val(),this.is_valid_french_polynesian_number(e)?(this.hide_error,!0):phone_helpers.is_valid(e)?(this.hide_error(),!0):(this.show_error(i("Invalid phone number")),!1))},t.prototype.validate_on_submit=function(){return this.validate_on_blur()?this.is_empty()?(this.show_error(i("Please enter a phone number")),!1):!0:!1},t.prototype.focus=function(){return this.$phone_text.focus()},t.prototype.get=function(){var e,t;if(this.is_empty())return null;try{return t=phone_helpers.full_number(this.$country_select.val(),this.$phone_text.val())}catch(n){return e=n,null}},t.prototype.set=function(e){var t,n;if(!e)return this.$phone_text.val(""),void this._reformat();try{n=phone_helpers.split_number(e),n.iso_code&&(this.$country_select.val(n.iso_code),this.$phone_text.val(phone_helpers.format(n.dialing_code,n.phone_number)),this._reformat())}catch(o){return t=o,this.$phone_text.val(e),this.show_error(i("Invalid phone number"))}},t.prototype._setup_valhooks=function(){return this.$phone_input.each(function(){return this.type="phoneinput"}),e.valHooks.phoneinput={get:function(t){return o.controller(e(t)).get()},set:function(t,n){return o.controller(e(t)).set(n)}}},t.prototype._validate_phone_number=function(e,t){var n;return t=t.replace(/\D/g,""),n=""+e+" "+t,phone_helpers.format(e,t)},t}()});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/components/select_input",["jquery","external/underscore","modules/core/dom","modules/clean/components/tabbable","modules/clean/keycode"],function(e,t,n,o,r){var s,i;return s=function(t){return"string"==typeof t?t.toLowerCase():e(t).text().toLowerCase()},i=function(o){function i(e){this.$select_input=e,this._setup_valhooks=__bind(this._setup_valhooks,this),this._unfocus_options=__bind(this._unfocus_options,this),this._get_next=__bind(this._get_next,this),this._get_prev=__bind(this._get_prev,this),this.$dropdown=this.$select_input.find(".select-input-dropdown"),this.$select=this.$select_input.find("select"),this.$input_label=this.$select_input.find(".select-input-input"),this.$options=this.$dropdown.find(".select-option"),this.$sorted_options=t.sortBy(this.$options.not(".select-option-disabled"),s),this.mouse_input=!0,this._listen(),this._setup_valhooks(),i.__super__.constructor.call(this)}return __extends(i,o),i.DISABLED_OPTION_CLICKED="db:select_input:disabled_option_clicked",i.prototype.dropdown_shown=!1,i.prototype.$focused_option=null,i.prototype._keyboard_select_prefix="",i.prototype._keyboard_select_timeout=null,i.prototype.toggle_dropdown=function(){return this.dropdown_shown?this.hide_dropdown():this.show_dropdown()},i.prototype._scroll_to_include=function(e){var t,n,o,r;return r=this.$dropdown.scrollTop(),o=r+this.$dropdown.height(),n=e.position().top+r,t=n+e.height(),r>n?this.$dropdown.scrollTop(n):t>o?this.$dropdown.scrollTop(t-this.$dropdown.height()):void 0},i.prototype._set_focused_option=function(e){return e.length?(this.$focused_option&&this._unfocus_options(),this.$focused_option=e,this.$focused_option.addClass("focused-option"),this._scroll_to_include(this.$focused_option)):void 0},i.prototype._common_prefix_len=function(t,n){var o;for(t=e.trim(t).toLowerCase(),n=e.trim(n).toLowerCase(),o=0;o<t.length&&o<n.length&&t.charAt(o)===n.charAt(o);)o++;return o},i.prototype._pick_option_alphabetically=function(n){var o,r,i,u,a;return a=t.sortedIndex(this.$sorted_options,n,s),r=e(this.$sorted_options[Math.max(a-1,0)]),o=e(this.$sorted_options[Math.min(a,this.$sorted_options.length-1)]),u=this._common_prefix_len(n,r.text()),i=this._common_prefix_len(n,o.text()),u>=i?r:o},i.prototype.show_dropdown=function(){var e;return this.$select_input.hasClass("select-input-disabled")?void 0:(this.$select_input.addClass("select-input-dropdown-shown"),e=this.$select_input.val(),this._set_focused_option(this.$options.closest('[data-value="'+e+'"]').first()),this.dropdown_shown=!0)},i.prototype.hide_dropdown=function(){return this.$select_input.removeClass("select-input-dropdown-shown"),this.dropdown_shown=!1,this._unfocus_options(),this.$focused_option=null},i.prototype._listen=function(){var n,o;return this.$select_input.hasClass("select-input-disabled")||this.$input_label.click(function(e){return function(){return e.toggle_dropdown()}}(this)),e(document).click(function(t){return function(n){var o;return t.dropdown_shown&&(o=e(n.target).closest(".select-input-input"),!o.length||o[0]!==t.$input_label[0])?t.hide_dropdown():void 0}}(this)),this.$options.click(function(t){return function(n){var o;return o=e(n.target).closest(".select-option"),o.hasClass("select-option-disabled")?(t.$select_input.trigger(i.DISABLED_OPTION_CLICKED),!1):t._set_value(o.data("value"),o)}}(this)),this.$input_label.on("keydown",function(e){return function(n){var o;if(e.mouse_input=!1,n.keyCode===r.TAB)return e.hide_dropdown(),!0;if(n.keyCode===r.ESC)return e.hide_dropdown();if(n.keyCode===r.ENTER){if(e.dropdown_shown&&e.$focused_option)return e._set_value(e.$focused_option.data("value"),e.$focused_option),e.hide_dropdown()}else{if(n.keyCode===r.UP||n.keyCode===r.DOWN)return e.dropdown_shown&&e.$focused_option?n.keyCode===r.UP&&e._get_prev(e.$focused_option).length?e._set_focused_option(e._get_prev(e.$focused_option)):n.keyCode===r.DOWN&&e._get_next(e.$focused_option).length&&e._set_focused_option(e._get_next(e.$focused_option)):e.show_dropdown(),!1;if(!t.contains(t.values(r),n.keyCode)&&(o=String.fromCharCode(n.which),e._keyboard_select_prefix=e._keyboard_select_prefix+o,e._set_focused_option(e._pick_option_alphabetically(e._keyboard_select_prefix)),e._keyboard_select_timeout&&clearTimeout(e._keyboard_select_timeout),e._keyboard_select_timeout=setTimeout(function(){return e._keyboard_select_prefix="",e._keyboard_select_timeout=null},500)," "===o))return!1}}}(this)),n=null,o=null,this.$dropdown.mousemove(function(e){return function(t){return(t.pageX!==n||t.pageY!==o)&&(e.mouse_input=!0),n=t.pageX,o=t.pageY}}(this)),this.$options.hover(function(t){return function(n){return t.mouse_input?t._set_focused_option(e(n.currentTarget)):void 0}}(this))},i.prototype._get_prev=function(e){return e.prev(":not(.select-option-disabled)")},i.prototype._get_next=function(e){return e.next(":not(.select-option-disabled)")},i.prototype._unfocus_options=function(){return this.$options.removeClass("focused-option")},i.prototype._setup_valhooks=function(){return this.$select_input.each(function(){return this.type="selectinput"}),e.valHooks.selectinput={get:function(){return function(t){return e(t).find("select").val()}}(this),set:function(){return function(t,o){return n.controller(e(t))._set_value(o)}}(this)}},i.prototype._set_value=function(e,t){return t||(this.$select.val(e),t=this.$options.not(".select-option-disabled").closest('[data-value="'+e+'"]').first()),t.length?(this.$input_label.find(".select-option").remove(),this._unfocus_options(),this.$input_label.prepend(n.clone(t)),this.$select.val(e),this.$select_input.trigger("change")):void 0},i}(o)});var __slice=[].slice;define("modules/clean/components/tab_nav",["jquery","external/underscore","external/react","modules/clean/css"],function(e,t,n){var o,r,s;return s=n.DOM,r=n.addons.classSet,o=n.PropTypes,n.createClass({displayName:"TabNav",propTypes:{tabs:o.arrayOf(o.oneOfType([o.string,o.number,o.shape({value:o.oneOfType([o.string,o.number]),label:o.string,rightAlign:o.bool})])).isRequired,defaultSelectedIndex:o.number,onChange:o.func},getDefaultProps:function(){return{defaultSelectedIndex:0,onChange:function(){}}},getInitialState:function(){return{selectedIndex:this.props.defaultSelectedIndex}},componentDidMount:function(){return this._fixTabWidth()},componentDidUpdate:function(){return this._fixTabWidth()},_normalizedTabs:function(){return this.props.tabs.map(function(e){return("string"==typeof e||"number"==typeof e)&&(e={value:e,label:e}),e})},_fixTabWidth:function(){return e("a",this.getDOMNode()).width(function(){return e(this).width()})},_onClick:function(e){var n,o,r,s;return e.preventDefault(),r=e.currentTarget.parentNode,n=this.getDOMNode().children,o=t.indexOf(n,r),o!==this.state.selectedIndex?(s=this._normalizedTabs()[o],this.setState({selectedIndex:o}),this.props.onChange(s.value,o)):void 0},render:function(){var e,t,n,o,i;return i=this._normalizedTabs(),e=function(e){return function(t,n){var o,i;return i={"c-tab-nav__tab":!0,"c-tab-nav__tab--is-active":n===e.state.selectedIndex,"c-tab-nav__tab--fr":t.rightAlign},o=s.a({href:"#",onClick:e._onClick},t.label),s.li({className:r(i),"data-value":t.value},o)}}(this),n=function(){var n,r,s;for(s=[],t=n=0,r=i.length;r>n;t=++n)o=i[t],s.push(e(o,t));return s}(),s.ul.apply(s,[{className:"c-tab-nav"}].concat(__slice.call(n)))}})}),define("modules/clean/components/tabs",["jquery","external/underscore","modules/core/dom","modules/clean/keycode"],function(e,t,n,o){var r;return r=function(){function r(o){var r,s,i,u;this.container=o,n.set_controller(this.container,this),this.tabs=this.container.children(".tab-bar").find(".tab-tab .tab-label[role='tab']"),this._listen(),e(window).trigger("hashchange"),this.container.hasClass("tabs--center")||(r=this.container.innerWidth(),i=t.reduce(function(){var t,n,o,r;for(o=this.tabs,r=[],t=0,n=o.length;n>t;t++)s=o[t],r.push(e(s).outerWidth());return r}.call(this),function(e,t){return e+t},0),i>.8*r&&(u=(r-i)/this.tabs.length+1,this.tabs.css("width","+="+u)))}return r.TAB_SHOWN="tabs:tab_shown",r.get_tabs=function(t){return n.controller(e("#"+t))},r.prototype._listen=function(){var t;return e(window).bind("hashchange",function(t){return function(){var n,o,r,s,i;return n=window.location.hash.split("#")[1],s=t.container.find("[data-hash-prefix]"),r=function(t){var o;return o=e(t).data("hash-prefix"),0===(null!=n?n.indexOf(o):void 0)},o=function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)i=s[e],r(i)&&n.push(i);return n}(),o.length>0?t._show_tab(e(o[0]),!1):t._show_tab(t.container.find("[data-hash="+n+"]"),!1)}}(this)),t=this.container.children(".tab-bar").find(".tab-tab .tab-label[role='tab']"),t.click(function(t){return function(n){var o,r;return o=e(n.currentTarget),r=o.data("hash")||window.location.hash,window.location.hash!==r&&(window.location.hash=r),t._show_tab(o,!0),!1}}(this)),t.keydown(function(n){return function(r){var s,i,u,a,c;return s=e(r.currentTarget),i=n.tabs.index(s),(a=r.keyCode)===o.LEFT||a===o.UP?(u=e(0===i?n.tabs[n.tabs.length-1]:n.tabs[i-1]),n._show_tab(u,!0),!1):(c=r.keyCode)===o.RIGHT||c===o.DOWN?(u=e(i===t.length-1?t[0]:t[i+1]),n._show_tab(u,!0),!1):void 0}}(this))},r.prototype._show_tab=function(e,t){var n;if(e.length)return n=this.container.children(".tab-bar").children(".tab-tab"),n.removeClass("selected"),n.children("[role='tab']").attr("tabindex","-1").attr("aria-selected","false"),this.container.children(".tab-content").removeClass("selected"),e.attr("tabindex","0").attr("aria-selected","true"),e.parent().addClass("selected"),this.container.find("#"+e.data("id")).addClass("selected"),this.container.trigger(r.TAB_SHOWN,e),t?e.focus():void 0},r.prototype.show_tab=function(e){return this._show_tab(this.container.children(".tab-bar").find(".tab-tab [data-id="+e+"]")(!1))},r}()}),define("modules/clean/css",["jquery","modules/clean/static_urls","modules/core/exception","modules/core/uri"],function(e,t,n,o){var r,s,i,u,a,c,l;for(u=t.static_url,r=n.assert,l={},i=e('link[rel="stylesheet"]'),a=0,c=i.length;c>a;a++)s=i[a],l[o.parse(e(s).attr("href")).path]=!0;return{css_url:function(e){return'url("'+String(e).replace("\\","\\\\").replace('"','\\"')+'")'},require_css:function(t){var n;r(0===t.indexOf("/static/css/"),"invalid static css path: "+t),t in l||(l[t]=!0,n=e("<link />",{href:u(t),rel:"stylesheet"}),e("head").append(n))}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/db_select",["jquery","modules/core/browser","modules/core/dom"],function(e,t,n){var o;return o=function(){function o(n){this.$select_container=n,this._setup_valhooks=__bind(this._setup_valhooks,this),this.on_option_click=__bind(this.on_option_click,this),this.$select_elm=this.$select_container.find(".db-select"),this.$select_elm.on("mousedown",function(e){return function(){return e.toggle_dropdown(),t.msie_version_at_most(8)&&setTimeout(function(){return e.$select_elm.blur()},0),!1}}(this)),this.$select_elm.on("focus",function(e){return function(){return t.msie_version_at_most(8)?!1:(e.show_dropdown(),!1)}}(this)),this.$select_elm.on("blur",function(e){return function(){return t.msie_version_at_most(8)?!1:(e.hide_dropdown(),!1)}}(this)),this.$select_elm.click(function(){return function(){return!1}}(this)),e(document).click(function(e){return function(){return e.hide_dropdown()}}(this)),t.msie_version_at_most(8)||this.$select_elm.css("background-image",this.background_image),this._setup_valhooks()}return o.prototype.background_image="url('/static/images/downarrow_gray-vfldLgMOB.png')",o.prototype.on_option_click=function(t){var n,o,r;return o=e(t.target),r=o.data("val"),n=o.data("index"),o.hasClass("disabled")?(this.$select_elm.trigger("disabled-option-clicked",r),!1):this.$select_elm.prop("selectedIndex",n).change()},o.prototype.toggle_dropdown=function(){return null!=this.dropdown?this.hide_dropdown():this.show_dropdown()},o.prototype.show_dropdown=function(){var t,n,o,r,s,i,u;if(!this.dropdown){for(this.$select_elm.addClass("dropdown"),r=e("<ul class='db-select-list' />"),u=this.$select_elm.find("option"),t=s=0,i=u.length;i>s;t=++s)o=u[t],o=e(o),n=e("<li/>").text(o.data("dropdown-label")||o.text()),n.data("val",o.val()),n.data("index",t),o.hasClass("disabled")&&n.addClass("disabled"),n.click(this.on_option_click),r.append(n);return this._generate_dropdown_from_ul(r)}},o.prototype._generate_dropdown_from_ul=function(e){var t;return this.dropdown=e.appendTo(this.$select_elm.parent()),this.dropdown.width(this.$select_elm.innerWidth()),t=this.$select_elm.offset(),t.top+=this.$select_elm.innerHeight()+1,this.dropdown.offset(t)},o.prototype.hide_dropdown=function(){return this.dropdown?(this.$select_elm.removeClass("dropdown"),this.dropdown.remove(),delete this.dropdown):void 0},o.prototype.enable=function(e){var t;return t=this.$select_elm.find("option[value="+e+"]"),t.removeClass("disabled")},o.prototype.disable=function(e){var t;return t=this.$select_elm.find("option[value="+e+"]"),t.addClass("disabled")},o.prototype._setup_valhooks=function(){return this.$select_container.each(function(){return this.type="dbselect"}),e.valHooks.dbselect={get:function(){return function(t){return e(t).find("select").val()}}(this),set:function(){return function(t,o){return n.controller(e(t))._set_value(o)}}(this)}},o}()});var __slice=[].slice;define("modules/clean/photos/carousel_app/excluded_folders_modal",["external/react","modules/clean/ajax","modules/clean/browse_interface","modules/clean/css","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/viewer","modules/core/i18n","modules/core/notify","jquery"],function(e,t,n,o,r,s,i,u,a,c,l){var d,h,p,_,f,m,y,b;return p=t.WebRequest,_=r.button,h=s.Modal,f=e.DOM,b=a.i18n_default_project("carousel-web")._,m=e.createClass({propTypes:{excludedPaths:e.PropTypes.array.isRequired,onUpdate:e.PropTypes.func.isRequired},getInitialState:function(){return{foldersToReinclude:{}}},stageForReinclusion:function(e,t){return t?this.state.foldersToReinclude[e]=!0:delete this.state.foldersToReinclude[e],this.setState(this.state.foldersToReinclude)},hasStagedChanges:function(){var e;for(e in this.state.foldersToReinclude)return!0;return!1},render:function(){var e,t;return this.props.excludedPaths.sort(function(e,t){return e.fq_path>t.fq_path}),f.div({},f.div({className:"excluded-folders-list"},function(){var n,o,r,s,i;for(r=this.props.excludedPaths,i=[],n=0,o=r.length;o>n;n++)s=r[n],e=s.fq_path,t=s.in_shared_folder,i.push(y({fqPath:e,key:e,isSharedFolder:t,stageForReinclusion:this.stageForReinclusion}));return i}.call(this)),f.div({className:"clearfix",style:{paddingBottom:5}},this.hasStagedChanges()?f.div({style:{"float":"right"}},[_({key:"update",style:{marginRight:5},onClick:function(e){return function(){var t;return e.props.onUpdate(function(){var e;e=[];for(t in this.state.foldersToReinclude)e.push(t);return e}.call(e)),h.close()}}(this)},b("Update")),_({key:"cancel",importance:"tertiary",onClick:function(){return function(){return c.error(b("No folders were added to your Timeline")),h.close()}}(this)},b("Cancel"))]):_({style:{"float":"right"},onClick:function(){return h.close()}},b("Close"))))}}),y=e.createClass({propTypes:{fqPath:e.PropTypes.string.isRequired,isSharedFolder:e.PropTypes.bool,stageForReinclusion:e.PropTypes.func.isRequired},getInitialState:function(){return{excluded:!0,hover:!1}},render:function(){var e,t,o,r,s,a;return e="Dropbox"+this.props.fqPath,a=e.split("/"),o=2<=a.length?__slice.call(a,0,s=a.length-1):(s=0,[]),t=a[s++],r=o.join("/")+"/",f.div({onMouseEnter:function(e){return function(){return e.setState({hover:!0})}}(this),onMouseLeave:function(e){return function(){return e.setState({hover:!1})}}(this),style:{clear:"both",backgroundColor:this.state.hover?"#f5fafe":void 0,padding:"1px 5px",overflowY:"auto"}},i({group:"web",name:this.props.isSharedFolder?"folder_user_32":"folder_32"}),f.div({style:{display:"inline-block",paddingLeft:"10px"}},f.span({style:{fontSize:"10pt"}},t),f.br({}),f.span({style:{fontSize:"10pt",color:"#ccc"}},r)),f.div({style:{"float":"right"}},this.state.hover||!this.state.excluded?f.a({href:String(n.browse_uri_for_fq_path(u.get_viewer().personal_user,this.props.fqPath)),target:"_blank",style:{margin:"0 20px"}},b("Show in folder")):void 0,this.state.excluded?this.state.hover?_({importance:"secondary",style:{marginTop:"5px"},onClick:function(e){return function(){return e.setState({excluded:!1}),e.props.stageForReinclusion(e.props.fqPath,!0)}}(this)},b("Add to Timeline")):void 0:_({style:{marginTop:"5px"},onClick:function(e){return function(){return e.setState({excluded:!0}),e.props.stageForReinclusion(e.props.fqPath,!1)}}(this)},b("Added",{comment:"means the folder, which was previously removed from Carousel, has been added back to the user's Carousel"}))))}}),d=function(){function e(){}return e.show=function(e,t){var n;return o.require_css("/static/css/carousel/app/excluded_folders_modal-vflaUEgN8.css"),n={marginBottom:-25},h.showInstance(h({title:b("Folders excluded from your Timeline"),width:Math.min(l(window).width()-400,900),onDismiss:function(e){return e.preventDefault()},acceptButtonText:null,showX:!1},f.div({style:n},f.p({},b("Photos and videos in these folders have been excluded from your Timeline")),m({excludedPaths:e,onUpdate:t}))))},e}()}),define("modules/clean/photos/photos_tab_settings",["external/react","modules/clean/ajax","modules/clean/photos/carousel_app/excluded_folders_modal","modules/clean/static_urls","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,r,s,i){var u,a,c,l,d,h,p;return a=t.WebRequest,l=o.static_url,c=e.DOM,p=s.i18n_default_project("carousel-web"),h=p._,d=p.ungettext,u=e.createClass({displayName:"ExcludedFoldersSettingsItem",getInitialState:function(){return{loading:!0,error:!1,excluded_paths:null}},componentDidMount:function(){return this.refreshExcludedPaths()},refreshExcludedPaths:function(){return a({url:"/app/ajax/get_excluded_folders",type:"GET",subject_user:r.get_viewer().personal_user,success:function(e){return function(t){return t=JSON.parse(t),e.setState({loading:!1,excluded_paths:t.excluded_paths})}}(this),error:function(e){return function(){return e.setState({loading:!1,error:!0})}}(this)})},reincludeCallback:function(e){return this.setState({loading:!0,error:!1}),a({url:"/app/ajax/reinclude_folders",subject_user:r.get_viewer().personal_user,data:{fq_paths:JSON.stringify(e)},success:function(){return i.success(h("These folders will be added to your Photos tab momentarily"))},error:function(){return i.error(h("Something went wrong - your changes weren’t successfully saved"))},complete:function(e){return function(){return e.refreshExcludedPaths()}}(this)})},render:function(){var e;return this.state.loading?c.div({},c.img({src:l("/static/images/loading-big-vfl-qdOjG.gif")})):this.state.error?c.div({},h("Failed to load excluded folders list")):(null!=(e=this.state.excluded_paths)?e.length:void 0)>0?c.p({},[c.span({key:"num_excluded_folders"},d("%(num)d excluded folder","%(num)d excluded folders",this.state.excluded_paths.length).format({num:this.state.excluded_paths.length})),c.span({key:"nbsp"}," "),c.a({key:"change_link",onClick:function(e){return function(){return n.show(e.state.excluded_paths,e.reincludeCallback,!0)}}(this)},h("Change"))]):c.p({},h("No folders excluded"))}})});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/photos/thumbnail_url_util",["external/underscore","modules/constants/python","modules/core/exception","modules/core/uri"],function(e,t,n,o){var r,s,i;return r=t.THUMBNAIL_SIZE_MODE,s=t.THUMBNAIL_SIZES,i=function(t,i,u,a){var c,l;return n.assert(null!=i&&null!=u,"Width and height must both be specified or neither"),l=""+i+"x"+u,n.assert(__indexOf.call(s,l)>=0,"Invalid thumbnail size ("+l+")"),c={size:l},null!=a&&(n.assert(__indexOf.call(e.values(r),a)>=0,"Invalid thumbnail size mode ("+a+")"),c.size_mode=a),o.parse(t).updateQuery(c).toString()},{ThumbnailSizeMode:r,thumbnailUrlForSize:i}}),define("modules/clean/profile",["jquery"],function(e){var t;return t={init:function(){return e(".account-inputs input").on("click",t.show_pref_submit),e(".account-inputs select").on("change",t.show_pref_submit),e("#prefs-cancel").on("click",t.reset_prefs),e("#prefs-submit").on("click",t.hide_pref_submit)},show_pref_submit:function(){return e("#prefs-submit").removeClass("hidden"),e("#prefs-cancel").removeClass("hidden")},hide_pref_submit:function(){return e("#prefs-submit").addClass("hidden"),e("#prefs-cancel").addClass("hidden")},reset_prefs:function(n){return n.preventDefault(),e("#profile-prefs")[0].reset(),t.hide_pref_submit(n)}},{Profile:t}}),define("modules/dirty/account",["jquery","dropbox","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/account/email","modules/clean/ajax","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/multiaccount_login","modules/clean/react/modal","modules/clean/viewer"],function(e,t,n,o,r,s,i,u,a,c,l,d){var h,p,_,f,m,y,b,v,g;return b=t.Twitter,v=n.assert,g=o._,p=s.ChangeEmail,_=s.EmailVerification,f=a.LinkedProfileServices,m=a.ProfileServicesLinkingHandler,y=l.SimpleModal,h={link_handler:function(){return new m},get_content_tab_selector:function(e){return d.get_viewer().is_paired&&e&&!location.href.endsWith("settings")?"#"+e+"-content":""},twitter_revoke_auth:function(t,n){return null==n&&(n=!0),v(null!=t,"user_id must be specified"),new Ajax.DBRequest("/twitter/disable",{onSuccess:function(){var o;return n&&r.success(g("Unlinked Twitter account.")),o=h.get_content_tab_selector(d.get_viewer().get_user_by_id(t).role),e(""+o+" .auth-twitter").closest("tr").removeClass("has-authed")},subject_user:t})},self_unban:function(){return e("#self-unban-form").submit()},twitter_auth_complete:function(t){
var n;return v(null!=t,"user_id must be specified"),r.success(g("Linked Twitter account.")),n=h.get_content_tab_selector(d.get_viewer().get_user_by_id(t).role),e(""+n+" .auth-twitter").closest("tr").addClass("has-authed")},show_account_login_modal:function(){return c.show_page_login_modal(window.location.href)},purge_contacts:function(t){return new Ajax.DBRequest("/account/purge_contacts",{subject_user:t,onSuccess:function(){var n;return n=h.get_content_tab_selector(d.get_viewer().get_user_by_id(t).role),e(""+n+" .deauth-facebook").hide(),e(""+n+" .auth-facebook").show(),e(""+n+" .auth-twitter").closest("tr").removeClass("has-authed"),e(""+n+" .auth-gmail").show(),e(""+n+" .deauth-gmail").hide(),e(""+n+" .auth-yahoo-mail").show(),e(""+n+" .deauth-yahoo-mail").hide(),e(""+n+" .remove-contact-sources").hide(),r.success(g("All contacts removed from Dropbox"))},onFailure:function(){return r.error(g("There was a problem removing your contacts"))}})},init:function(){return this.init=function(){},e(".auth-twitter-link").on("click",function(t){var n;return t.preventDefault(),n=e(this).attr("data-user-id"),b.do_auth(h.twitter_auth_complete,n)}),e(".auth-gmail-link").on("click",function(t){var n,o;return t.preventDefault(),o=e(this).attr("data-user-id"),n=function(t){var n;return t.success?(n=h.get_content_tab_selector(d.get_viewer().get_user_by_id(o).role),e(""+n+" .gmail-address").text(null!=t.profile?t.profile.email:g("Connected")),e(""+n+" .auth-gmail").hide(),e(""+n+" .deauth-gmail").show(),r.success(g("Imported Gmail Contacts."))):r.error(t.err_msg||g("We need your permission to import your Gmail contacts."))},h.link_handler().auth_service_with_user(u.GOOGLE,o,n)}),e(".auth-yahoo-link").on("click",function(t){var n,o;return t.preventDefault(),o=e(this).attr("data-user-id"),n=function(t){var n;return t.success?(n=h.get_content_tab_selector(d.get_viewer().get_user_by_id(o).role),e(""+n+" .auth-yahoo-mail").hide(),e(""+n+" .deauth-yahoo-mail").show(),r.success(g("Imported Yahoo! Mail contacts."))):r.error(t.err_msg||g("We need your permission to import your Yahoo! Mail contacts."))},h.link_handler().auth_service_with_user(u.YAHOO,o,n)}),e(".auth-facebook-link").on("click",function(t){var n,o;return t.preventDefault(),o=e(this).attr("data-user-id"),n=function(t){var n,s,i;return t.success?(s=h.get_content_tab_selector(d.get_viewer().get_user_by_id(o).role),n=t.success&&null!=(null!=(i=t.profile)?i.name:void 0)?t.profile.name:g("Connected"),e(""+s+" .facebook-username").text(n),e(""+s+" .auth-facebook").hide(),e(""+s+" .deauth-facebook").show(),r.success(g("Successfully connected to Facebook."))):r.error(t.err_msg||g("We need your permission to import your Facebook friends."))},h.link_handler().auth_service_with_user(u.FACEBOOK,o,n)}),e(".deauth-twitter-link").on("click",function(t){var n;return t.preventDefault(),n=e(this).attr("data-user-id"),h.twitter_revoke_auth(n)}),e(".deauth-gmail-link").on("click",function(t){var n,o;return t.preventDefault(),o=e(this).attr("data-user-id"),n=function(t){var n;return t?(n=h.get_content_tab_selector(d.get_viewer().get_user_by_id(o).role),e(""+n+" .auth-gmail").show(),e(""+n+" .deauth-gmail").hide(),r.success(g("Successfully removed Google contacts."))):r.error(g("We were unable to remove your Gmail contacts"))},h.link_handler().deauth_service(u.GOOGLE,o,null,n)}),e(".deauth-yahoo-link").on("click",function(t){var n,o;return t.preventDefault(),o=e(this).attr("data-user-id"),n=function(t){var n,s,i;return i=h.get_content_tab_selector(d.get_viewer().get_user_by_id(o).role),n=function(t){return t?(e(""+i+" .auth-yahoo-mail").show(),e(""+i+" .deauth-yahoo-mail").hide(),r.success(g("Successfully removed Yahoo! Mail contacts."))):r.error(g("We were unable to remove your Yahoo! Mail contacts."))},s=t.service_is_connected(u.YAHOO),t.service_is_connected(u.YAHOO_LEGACY)&&h.link_handler().deauth_service(u.YAHOO_LEGACY,o,null,s?null:n),s?h.link_handler().deauth_service(u.YAHOO,o,null,n):void 0},f.get_linked_profile_services_for_user(o,n)}),e(".deauth-facebook-link").on("click",function(t){var n,o;return t.preventDefault(),o=e(this).attr("data-user-id"),n=function(t){var n;return t?(n=h.get_content_tab_selector(d.get_viewer().get_user_by_id(o).role),e(""+n+" .facebook-username").text(""),e(""+n+" .auth-facebook").show(),e(""+n+" .deauth-facebook").hide(),r.success(g("Disconnecting your account from Facebook..."))):r.error(g("We were unable to disconnect from Facebook."))},h.link_handler().deauth_service(u.FACEBOOK,o,null,n)}),e(".purge-all-contacts-link").on("click",function(t){var n;return t.preventDefault(),n=e(this).attr("data-user-id"),y.show({title_text:g("Remove all contact sources"),body_html:"<p> <t> This will remove all of your imported contacts from Dropbox, disconnect Dropbox from the connected social and email services, and sign you out of the Dropbox mobile apps. If you sign into those apps again, your contacts may be re-uploaded to Dropbox. </t> </p> <p> <strong><t>You can't undo this operation.</t></strong> <t>Are you sure you want to remove all contacts? </t> </p>",cancel_text:g("Cancel"),confirm_text:g("Remove all contact sources"),confirm_callback:function(){return function(){return h.twitter_revoke_auth(n,!1),h.purge_contacts(n)}}(this)})})}},INLINE_JS.AccountPage=h}),define("modules/dirty/account/password_change",["dropbox","modules/core/i18n","modules/core/notify"],function(e,t,n){var o,r,s,i;return o=e.Forms,r=e.Modal,i=t._,s=function(){function e(e){this.$form=e,this.listen()}return e.user_id=null,e.RESET_FORM="password:change:reset",e.prototype.listen=function(){return $j(document).on(e.RESET_FORM,function(e){return function(){return e.$form.find(".password-field").val("")}}(this)),this.$form.find(".cancel").on("click",function(){return r.hide()}),this.$form.on("submit",function(t){return function(n){var r;return n.preventDefault(),r={},r[Constants.UID_PARAM_NAME]=e.user_id,o.ajax_submit(t.$form[0],!1,t.success,t.failure,null,r)}}(this))},e.prototype.success=function(){return window.location.reload()},e.prototype.failure=function(e){return 403===(null!=e?e.status:void 0)?(n.error(i("Request failed due to an unknown authentication error.  Please sign out of Dropbox and sign back in to try again.")),window.location.reload(!0)):void 0},e.reset=function(){return $j(document).trigger(e.RESET_FORM)},e.show_modal_for_user=function(t){return e.user_id=t,e.reset(),r.show(i("Change password"),$j("#change-password")[0],{},!1,450)},e}()}),define("modules/dirty/account/security_tab",["jquery","modules/dirty/account/password_change"],function(e,t){var n;return n=function(){function n(){e(".show-change-password").on("click",function(n){var o;return n.preventDefault(),o=e(n.target).data("uid"),t.show_modal_for_user(o)})}return n}()});